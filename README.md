
# 🏠 賃貸管理システム

**日本語版** | [English Version](./README_EN.md)


## 📋 目次

- [プロジェクトの背景](#プロジェクトの背景)
- [体験用URL](#体験用URL)
  - [モバイル端](#モバイル端)
  - [管理画面](#管理画面)
- [機能モジュール](#機能モジュール)
  - [モバイル端](#モバイル端)
  - [管理画面](#管理画面)
- [システムアーキテクチャ](#システムアーキテクチャ)
- [プロジェクト構造](#プロジェクト構造)
- [環境構築・デプロイ](#環境構築・デプロイ)
- [参考資料](#参考資料)

### プロジェクトデプロイ - AWS EC2デプロイガイド
[lease-docker-project](https://github.com/yukoto0718/lease-docker-project.git) 

## プロジェクトの背景

**U+アパート**は、尚硅谷の「尚庭公寓」オンラインコースを参考に、二次開発を行った賃貸プラットフォームプロジェクトです。モバイル端末と管理者向けの管理システムで構成されています。

- **モバイル端：** 一般ユーザー向けで、物件検索、内見予約、ブログ投稿、いいね、プライベートチャットなどの機能を提供します。
- **管理システム：** 管理者向けで、アパート管理、賃貸管理、ユーザー管理などの機能を備えています。

※ 説明内で表示される画像は、Alibaba Cloud のオブジェクトストレージサービス（OSS）を利用しています。


## 体験用URL
本デモサイトはAWS EC2（t2.micro、1年間無料）を利用して展開されており、ポートフォリオ展示目的での暫定運用となります。

### モバイル端
体験用URL：https://uplus-lease.online

①認証コードログイン：
自分のメールアドレスで認証コードを使ってログインし、自動的に新規ユーザーとして登録されます。

②パスワードログイン：
ユーザ①：`ユーザ名 13112345678 パスワード 123456`  
ユーザ②：`ユーザ名 13212345678 パスワード 123456`  
ユーザ③：`ユーザ名 13312345678 パスワード 123456`  

### 管理画面
体験用URL：https://uplus-lease.online/admin
`ユーザ名 user パスワード 123456` 


> **🔤多言語対応について**  
> - **モバイル端：** Vue i18n を使用した**3言語対応**（中国語・日本語・英語）
> - **管理画面：** **翻訳スクリプト**による**中日翻訳**を実装
> 
> **📝 お願い：** 管理画面の日本語表示につきましては、**有道APIを活用した翻訳スクリプト**（[chinese-to-japanese](https://github.com/yukoto0718/chinese-to-japanese.git)）による**一括翻訳処理**で生成されたため、一部不自然な表現や翻訳精度の問題がある可能性がございます。技術実装のデモンストレーション目的としてご理解いただければ幸いです。

## 機能モジュール

### モバイル端機能モジュール

**主な機能は下図の通りです：**
![](https://sky-yu0718.oss-cn-beijing.aliyuncs.com/LeaseU1.png)

### 画面一覧

各機能モジュールの詳細は以下の通りです。

- **登録・ログイン画面**

    ①メールアドレス宛にワンタイムコードを送信し、コード入力でログイン。未登録ユーザーはコード入力時に自動で新規登録。
    ②アカウント／パスワードログイン：ID・パスワード方式でもログイン可能

  ![](https://sky-yu0718.oss-cn-beijing.aliyuncs.com/LeaseU2.png)  


- **物件検索**
  豊富な検索条件：地理位置、賃料レンジ、支払い方法（前家賃／月払いなど）で絞り込み
  マップ連携：OpenStreetMap を利用し、地図上でエリアを指定して物件を検索・表示
  ![](https://sky-yu0718.oss-cn-beijing.aliyuncs.com/LeaseU3.png)  

**データベースのフィールドにおける i18n 利用例：**
`テーブル apartment_info：introduction_cn ・ introduction_en ・ introduction_ja`
  ![](https://sky-yu0718.oss-cn-beijing.aliyuncs.com/LeaseU4.png)  

- **マイページ**

① 内見予約管理：希望日時と物件を選んで内見予約、予約状況の確認・変更・キャンセルが可能

② 契約管理：現在の賃貸契約情報を一覧表示、契約終了（解約）や更新リクエストをアプリ上で提出

③ 閲覧履歴：過去にチェックした物件を一覧表示、再度詳細を見直したい物件をすぐに呼び出し

④ アバター＆ニックネーム編集：プロフィール用のアイコン画像とニックネームを自由に変更

  ![](https://sky-yu0718.oss-cn-beijing.aliyuncs.com/LeaseU5.png)  

- **コミュニティ機能**

① ブログ投稿
・全ユーザー公開のブログ記事を投稿可能
・いいね（Redis）・コメント機能
・コメント削除：ユーザーは自分が投稿したコメント、または自分のブログに付いたコメントを削除することができる
・投稿者のアイコンをタップすると該当ユーザーのプロフィールページへ遷移

② フォローリスト
・自分が「フォロー中」「フォロワー」「相互フォロー」しているユーザー一覧を表示
・フォロー解除操作や、アイコンタップでダイレクトチャット画面へ

③ プライベートチャット
・WebSocket を使ったリアルタイム双方向通信
・メッセージ一覧画面で未読件数を表示

  ![](https://sky-yu0718.oss-cn-beijing.aliyuncs.com/LeaseU6.png)  

### 管理画面

> **🔧 管理画面の実装範囲について**  
> 本プロジェクトの管理画面につきましては、**翻訳対応のみ**を実施しており、モバイル端のi18n機能に対応するため、**「データベースのフィールドにおける i18n 利用例」画面のみを修正**いたしました。
> 本READMEでは、独自実装部分のみスクリーンショットを掲載いたします。
> その他の管理機能については、**実装済みの基本機能をそのまま維持**しており、機能の詳細確認をご希望の場合は以下をご参照ください：
> - 🌐 [体験用URL](http://54.95.189.69:8888) にて実際の操作確認
> - 📚 [参考資料](#参考資料)に確認

**主な機能は下図の通りです：**

* **アパート情報管理**  
アパート名称、住所、連絡先等の基本情報を管理。物件の追加・編集・削除機能を提供。

* **部屋情報管理**  
各アパート内の部屋詳細（部屋番号、間取り、面積、賃料等）を管理。部屋情報の一括管理が可能。

* **物件属性管理**  
アパート・部屋の各種属性（設備・仕様等）を定義。管理者が物件情報登録時に選択可能な属性を設定。

* **内見予約管理**  
ユーザーからの内見予約申請を管理。モバイル端からの予約を確認し、スタッフのスケジュール調整を支援。

* **賃貸契約管理**  
賃貸契約の作成・修正・終了を管理。契約書生成機能により、ユーザーへの契約送信を効率化。

* **管理者アカウント管理**  
後台システムの管理者アカウントを管理。アカウント作成・編集・削除・無効化機能を提供。

* **ユーザー管理**  
モバイル端ユーザーの情報管理。ユーザー情報確認およびアカウント関連問題の対応。

**データベースのフィールドにおける i18n 利用例：**
  ![](https://sky-yu0718.oss-cn-beijing.aliyuncs.com/LeaseU7.png)  

## システムアーキテクチャ


> **🔧 開発環境構成の背景について**  
> 本プロジェクトは、**学習初期段階でCentOS7仮想マシン上での従来型開発**から始まりました。MySQL、Redis、MinIOを仮想マシンにインストールし、Windows開発環境から接続する構成で学習を進めていました。
> 
> その後、**実際のデプロイメントを考慮した際に、Dockerによるコンテナ化の優位性**を認識し、仮想マシン上に**Docker環境を追加構築**しました。これにより、**従来の開発環境を維持しつつ、本番同等のコンテナ化テスト環境**を併用する柔軟な開発体制を実現しています。

**システムアーキテクチャの通りです：**
```
┌──────────────────────────────────────────────────────────────────────────────────────┐
│                             💻開発環境 (Windows PC)                                  │
├──────────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────┐    ┌─────────────────────┐                                  │
│  │   IntelliJ IDEA     │    │      VSCode         │                                  │
│  │                     │    │                     │                                  │
│  │     SpringBoot      │    │     Vue3 Frontend   │                                  │
│  │     JDK 17          │    │     TypeScript      │                                  │
│  │     MyBatis Plus    │    │     Vite            │                                  │
│  └─────────────────────┘    └─────────────────────┘                                  │
│           └──────────┬────────────────┘                                              │
│                      ↓ (接続)                                                        │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                     CentOS7 VM - 開発用サービス                                  │ │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐                                │ │
│  │  │   MySQL     │ │    Redis    │ │   MinIO     │                                │ │
│  │  └─────────────┘ └─────────────┘ └─────────────┘                                │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────────────────────────────────┘
↓ (JAR + Dist ファイルアップロード)
┌──────────────────────────────────────┼───────────────────────────────────────────────┐
│                                      │     🧪 テスト環境 (CentOS7 VM)                │
├──────────────────────────────────────┼───────────────────────────────────────────────┤
│                                      ↓                                               │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                            🐳 Docker Compose 環境                               │ │
│  │ ┌────────┐ ┌────────┐ ┌────────┐ ┌─────────┐ ┌────────┐ ┌────────┐ ┌────────┐   │ │
│  │ │ nginx  │ │webadmin│ │ webapp │ │  mysql  │ │ redis  │ │ minio  │ │adminer │   │ │
│  │ └────────┘ └────────┘ └────────┘ └─────────┘ └────────┘ └────────┘ └────────┘   │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
└───────────────────────────────────────┼──────────────────────────────────────────────┘
↓ (Git Push)
┌───────────────────────────────────────┼─────────────────────────────────────────────┐
│                              📁 GitHub Repository                                  │
├───────────────────────────────────────┼─────────────────────────────────────────────┤
│  🔄 GitHub Actions (自動デプロイ)                                                   │
└───────────────────────────────────────┼─────────────────────────────────────────────┘
↓
┌───────────────────────────────────────┼─────────────────────────────────────────────┐
│                      ☁️ AWS EC2 本番環境 (t2.micro)                                 │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

## プロジェクト構造
```
lease-system-backend/
├── common  # 共通モジュール(汎用ユーティリティ、共通設定)
│   ├── pom.xml
│   └── src
├── model  #データモデル
│   ├── pom.xml
│   └── src
├── web  # Webアプリケーション層
│   ├── pom.xml
│   ├── web-admin  # 管理画面Webモジュール
│   │   ├── pom.xml
│   │   └── src
│   └── web-app  # モバイル端Webモジュール
│       ├── pom.xml
│       └── src
└── pom.xml
```

## 環境構築・デプロイ
### ☁️ AWS EC2 基本設定

#### EC2インスタンス構成
| 項目 | 設定値 | 説明 |
|------|--------|------|
| **インスタンスタイプ** | t2.micro | 無料枠対応（vCPU: 1、メモリ: 1GB） |
| **OS** | Amazon Linux 2023 | AWS最適化、Docker対応 |
| **ストレージ** | 30GB  | 無料枠内でプロジェクト十分対応 |
| **セキュリティグループ** | 8つポート | 22,80,8080,8888など |

#### 🌐 Elastic IP 設定

**固定IPアドレス確保**
設定理由: EC2インスタンスの停止・再起動時にIPアドレスが変更されることを防ぎ、安定したサービス提供と設定ファイルの一貫性を確保。

**データベース初期導入**
```
lease-docker-project/
├── data/                  
│   ├── mysql/              # データベース初期データ
│   ├── redis/              # Redisデータ
│   └── minio/              # MinIOファイル
└── docker-compose.yml
```
* データ導入方法: データベースファイルは初回GitHub Push時に同梱し、Docker Compose起動時に自動的にマウント・初期化される設計です。デプロイ完了後、セキュリティ考慮によりdataフォルダはリポジトリから削除しました。

**GitHub Actions (自動デプロイ)**

🔄 デプロイプロセス
* GitHub Actions 自動デプロイ
```yaml
# .github/workflows/deploy.yml
name: Deploy to AWS EC2
on:
  push:
    branches: [ main ]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to EC2
        run: |
          ssh -i ${{ secrets.EC2_PRIVATE_KEY }} ec2-user@${{ secrets.EC2_HOST }}
          cd lease-docker-project
          git pull origin main
          docker-compose down
          docker-compose up -d --build
```    

🚨 問題と解決策
**問題1: AWS t2.micro メモリ不足によるOOM**
**現象**: MySQL等のコンテナが繰り返し再起動 Restarting (137) - OOMKilled
```bash
"OOMKilled": true,
"Status": "restarting", 
Restarting (137) 17 seconds ago
```
**原因**:
t2.micro物理メモリ: 1GB
プロジェクト必要メモリ: ~1.4GB
結果: メモリ不足でコンテナ強制終了

**解決方案**: ✅ Swap仮想メモリ作成 + Docker内存制限解除
```bash
# 1GB Swapファイル作成
sudo dd if=/dev/zero of=/swapfile bs=1M count=1024
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile

# Swap使用戦略最適化
echo 'vm.swappiness=10' | sudo tee -a /etc/sysctl.conf
sudo sysctl vm.swappiness=10

# Dockerコンテナ内存制限解除
# deploy.resources.limits.memory: 80M → 完全削除
```
効果: メモリ問題完全解決、総利用可能メモリ2GBに倍増
現象: t2.microは1GBメモリのみ、しかしプロジェクトには約1.5GB必要
```bash
システム利用可能メモリ: ~950MB
プロジェクト実際必要量: 1060-1470MB
結果: メモリ不足、サービス正常起動不可
```
解決方案: ✅ メモリ最適化設定
```yaml
# 重要最適化パラメータ
JAVA_OPTS: "-Xmx220m -Xms120m -XX:+UseG1GC"  # Javaアプリケーションメモリ最適化
innodb-buffer-pool-size=48M                    # MySQLメモリ最適化
maxmemory 48mb                                  # Redisメモリ制限
```
      
## 参考資料

🔗 **関連リポジトリ**
- [尚硅谷Java项目【尚庭公寓】从0开始Java项目实战](https://www.bilibili.com/video/BV1At421K7gP/)

**画像**
プロジェクトの画像は、中国の「冠寓」の公開コンテンツに基づいています。
