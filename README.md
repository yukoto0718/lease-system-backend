# 🏠 賃貸管理システム | Rental Management System

[🇺🇸 English Version](./README_EN.md)

# プロジェクトの背景

**U+アパート**は、尚硅谷の「尚庭公寓」オンラインコースを参考に、二次開発を行った賃貸プラットフォームプロジェクトです。モバイル端末と管理者向けの管理システムで構成されています。

- **モバイル端：** 一般ユーザー向けで、物件検索、内見予約、ブログ投稿、いいね、プライベートチャットなどの機能を提供します。
- **管理システム：** 管理者向けで、アパート管理、賃貸管理、ユーザー管理などの機能を備えています。

※ 説明内で表示される画像は、Alibaba Cloud のオブジェクトストレージサービス（OSS）を利用しています。

## モバイル端

体験用URL：http://117.72.33.7:81/

①認証コードログイン：
自分のメールアドレスで認証コードを使ってログインし、自動的に新規ユーザーとして登録されます。

②パスワードログイン：
`ユーザ名 13112345678 パスワード 123456`  
`ユーザ名 13212345678 パスワード 123456`

**主な機能は下図の通りです：**
![](https://sky-yu0718.oss-cn-beijing.aliyuncs.com/LeaseU1.png)

### 機能モジュール

各機能モジュールの詳細は以下の通りです。

- **登録・ログイン画面**

  ①メールアドレス宛にワンタイムコードを送信し、コード入力でログイン。未登録ユーザーはコード入力時に自動で新規登録。
  ②アカウント／パスワードログイン：ID・パスワード方式でもログイン可能

  ![](https://sky-yu0718.oss-cn-beijing.aliyuncs.com/LeaseU2.png)


- **物件検索**
  豊富な検索条件：地理位置、賃料レンジ、支払い方法（前家賃／月払いなど）で絞り込み
  マップ連携：OpenStreetMap を利用し、地図上でエリアを指定して物件を検索・表示
  ![](https://sky-yu0718.oss-cn-beijing.aliyuncs.com/LeaseU3.png)

**データベースのフィールドにおける i18n 利用例：**
`テーブル apartment_info：introduction_cn ・ introduction_en ・ introduction_ja`
![](https://sky-yu0718.oss-cn-beijing.aliyuncs.com/LeaseU4.png)

- **マイページ**

① 内見予約管理：希望日時と物件を選んで内見予約、予約状況の確認・変更・キャンセルが可能

② 契約管理：現在の賃貸契約情報を一覧表示、契約終了（解約）や更新リクエストをアプリ上で提出

③ 閲覧履歴：過去にチェックした物件を一覧表示、再度詳細を見直したい物件をすぐに呼び出し

④ アバター＆ニックネーム編集：プロフィール用のアイコン画像とニックネームを自由に変更

![](https://sky-yu0718.oss-cn-beijing.aliyuncs.com/LeaseU5.png)

- **コミュニティ機能**

① ブログ投稿
・全ユーザー公開のブログ記事を投稿可能
・いいね（Redis）・コメント機能
・コメント削除：ユーザーは自分が投稿したコメント、または自分のブログに付いたコメントを削除することができる
・投稿者のアイコンをタップすると該当ユーザーのプロフィールページへ遷移

② フォローリスト
・自分が「フォロー中」「フォロワー」「相互フォロー」しているユーザー一覧を表示
・フォロー解除操作や、アイコンタップでダイレクトチャット画面へ

③ プライベートチャット
・WebSocket を使ったリアルタイム双方向通信
・メッセージ一覧画面で未読件数を表示

![](https://sky-yu0718.oss-cn-beijing.aliyuncs.com/LeaseU6.png)

## 后台管理系统

### 体验地址

后台管理系统的线上体验地址为：http://117.72.33.7:80/  点击会立刻跳转，请先复制粘贴下方账号密码。

`账号 chenchaofeng 密码 123456`

- 尽量不要使用科学上网工具访问该站点；
- 图片加载可能稍慢，服务器带宽限制；
- 相关官方的站点，本体验地址支持新增、删除等敏感操作；
- 鉴于有人长期蓄意删除系统用户，站点进行了升级，禁止对个别账号修改、删除，以免系统无法访问。

### 功能模块

各功能模块具体内容如下

- **公寓信息管理**

  这个模块负责管理所有公寓的基本信息，包括公寓名称、地址、联系方式等。管理员可以在这里添加、编辑、删除公寓信息。

- **房间信息管理**

  该模块负责管理每个公寓内各个房间的详细信息，包括房间号、户型、面积、租金等。管理员可以在这里进行房间信息的添加、编辑和删除。

- **公寓/房间属性管理**

  这个模块允许管理员定义公寓和房间的各种属性，比如公寓和房间的配套设施，方便管理员在维护公寓信息和房间信息时进行选择。

- **看房预约管理**

  该模块用于管理用户的看房预约请求。用户可以在移动端提交看房预约，管理员可以在后台管理系统中查看和处理这些请求，以方便安排人员接待用户。

- **租约管理**

  这个模块用于管理租约的创建、修改和终止。管理员可以在这里生成租约合同，并发送给用户签约。

- **后台系统用户管理**

  该模块用于管理后台系统的用户账户信息，管理员可以创建、编辑、删除、禁用账户信息。

- **移动端用户管理**

  这个模块负责管理移动端用户的信息。管理员可以查看用户信息，处理账户相关问题。

### 功能展示

#### 登录页面

![image-20240929105008859](https://typora-1256823886.cos.ap-nanjing.myqcloud.com/2023/image-20240929105008859.png)



![image-20240929105105121](https://typora-1256823886.cos.ap-nanjing.myqcloud.com/2023/image-20240929105105121.png)

#### 系统管理（部分）

![image-20240929105202490](https://typora-1256823886.cos.ap-nanjing.myqcloud.com/2023/image-20240929105202490.png)

#### 公寓管理（部分）

![image-20240929105252290](https://typora-1256823886.cos.ap-nanjing.myqcloud.com/2023/image-20240929105252290.png)

租赁管理（部分）

![image-20240929105330655](https://typora-1256823886.cos.ap-nanjing.myqcloud.com/2023/image-20240929105330655.png)

#### 用户管理

![image-20240929105356648](https://typora-1256823886.cos.ap-nanjing.myqcloud.com/2023/image-20240929105356648.png)


# 源码结构
```
lease
├── common（公共模块——工具类、公用配置等）
│   ├── pom.xml
│   └── src
├── model（数据模型——与数据库相对应地实体类）
│   ├── pom.xml
│   └── src
├── web（Web模块）
│   ├── pom.xml
│   ├── web-admin（后台管理系统Web模块——包含mapper、service、controller）
│   │   ├── pom.xml
│   │   └── src
│   └── web-app（移动端Web模块——包含mapper、service、controller）
│       ├── pom.xml
│       └── src
└── pom.xml
```



# 部署相关

该项目主要涉及到的基础设施为mysql、reids、minio、nginx等，涉及到的服务有阿里云短信服务等。该项目部署到~~腾讯云~~ 京东云主机，能够稳定运行。

- 主机配置：
    - 系统 - CentOS 7.6 64bit
    - CPU - 2核
    - 内存 - 2GB
    - 系统盘 - 50GB
    - 带宽 - ~~4Mbps~~ 1Mbps

- 部署文档：
    - 基础设施安装：xxx 待续
    - 前后端部署：xxx 待续




# 参考资料

所有资料：
- 链接：https://pan.baidu.com/s/18gU7FbbHdv9vRLnPIywl2g?pwd=yyds
- 提取码：yyds

成品源码：

- [chaofengdev/shangting-lease: 尚庭公寓完整源码 (github.com)](https://github.com/chaofengdev/shangting-lease)



# 您可能遇到的问题

### 功能相关

- 公寓图片和房间图片，无法正常显示
    - 原因：初始数据库中，apartment_info表、room_info表的图片均需关联到graph_info表，graph_info表的url字段保存的是minio的图片地址，非公网地址。
    - 解决：在后台管理系统web-admin中，按照业务流程添加公寓图片和房间图片即可。
- 新增或修改公寓信息时，无法正常更新公寓的所在地址
    - 原因：前端显示的是地址的省、市、区名称，而新增或修改公寓信息保存的是地址的省、市、区id，名称没有保存。
    - 解决：可以在前端增加保存地址名称的逻辑，也可以在后端根据地址id找到名称，更新vo对象后保存。

### 开发相关

- common模块`@MapperScan("com.atguigu.lease.web.*.mapper")` 爆红，同时web模块下的mapper注入均爆红
    - 原因：idea显示问题，因为在common模块下没有依赖web模块，所以去扫描web模块下的mapper，不能正确扫描到。
    - 解决：纯idea显示问题，不影响打包部署。也可以将该注解分别加入到`web-admin` 和`web-app` 的启动类上，可解决爆红问题。

### 部署相关

- 部署到腾讯云主机始终无法正确访问服务
    - 检查云主机端口是否开放，需要开放对应端口，如80、81、8080、8081等；
    - 检查nginx服务是否正常启动，配置文件是否书写正确；
    - 检查后端服务是否正确启动，可以使用xxx/doc.html测试接口是否正常工作来确定；
    - 等等
- 加载页面非常慢
    - 检查mysql是否正常工作，可以使用本地客户端软件；
    - 检查是否启用了科学上网工具，部分节点限制了速度；
- 前后端都能访问文档，但是无法连通
    - 优先排查nginx配置文件；
    - 如果nginx配置没问题，查看后端的日志报错信息；




# 后续工作

- [x] 部署文档完善
- [ ] 简历书写
- [ ] 录制云部署视频



# 其他

- 官方参考文档里存在少量错误代码，常见于sql语句和service层代码，直接复制粘贴后，请务必测试主要功能点；
- 本仓库代码修复了文档里的错误，可以直接使用，使用前请配置`web-admin` 和`web-app`模块下的`application.yml` （重要）；
- 云部署需要考虑的东西比较多，请您务必在本机测试完成后再部署到云端；
- 如果对您有帮助，给个star，感谢~~
